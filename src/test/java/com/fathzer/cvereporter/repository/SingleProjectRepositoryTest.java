package com.fathzer.cvereporter.repository;

import static org.junit.jupiter.api.Assertions.*;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.NoSuchFileException;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.List;

import org.junit.jupiter.api.Test;

import com.fathzer.cvereporter.common.Project;

class SingleProjectRepositoryTest {
	private static final String POM_XML = "pom.xml";
	
	private static final Path PROJECT_PATH = Paths.get("src/test/resources/projects/p1");
	
	@Test
	void test() throws IOException {
		final Path unkownDir = Paths.get("src/test/resources/unknownDir");
		assertThrows(IllegalArgumentException.class, () -> new SingleProjectRepository(unkownDir));
		final Path notADir = PROJECT_PATH.resolve("pom.xml");
		assertTrue(Files.exists(notADir));
		assertThrows(IllegalArgumentException.class, () -> new SingleProjectRepository(notADir));

		final CodeRepository repo = new SingleProjectRepository(PROJECT_PATH);
		final List<Project> projects = repo.getProjects();
		assertEquals(1, projects.size());
		final String fileContent = repo.getFile(projects.get(0), POM_XML);
		assertNotNull(fileContent);

		assertThrows(NoSuchFileException.class, () -> repo.getFile(new Project("0", "x"), POM_XML));
	}
}
