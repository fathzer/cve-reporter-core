package com.fathzer.cvereporter.cve;

import static org.junit.jupiter.api.Assertions.*;

import java.io.IOException;

import org.junit.jupiter.api.Test;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fathzer.cvereporter.common.Artifact;
import com.fathzer.cvereporter.common.VersionRange;

import lombok.Getter;

class CVETest {
	@Test
	void testSerialization() throws IOException {
		final Artifact a = new Artifact("a", "b");
		final VersionRange r = new VersionRange("1.0");
		final CVE c = new CVE("x", a, r, "toto");
		
		final ObjectMapper mapper = new ObjectMapper();
		final String json = mapper.writeValueAsString(c);
		assertEquals(c.getIdentifier(), mapper.readValue(json, CVE.class).getIdentifier());
		
		final CVE b = new CVE("x", a, r, "toto") {
			@Getter
			private String other = "other";
		};
		final String json2 = mapper.writeValueAsString(b);
		assertNotEquals(json, json2);
		assertEquals(c.getArtifact(), mapper.readValue(json2, CVE.class).getArtifact());
	}
}
