package com.fathzer.cvereporter;

import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fathzer.cvereporter.builder.BuildStatus;
import com.fathzer.cvereporter.common.Project;

import lombok.NonNull;

@JsonIgnoreProperties(ignoreUnknown = true)
public class ProjectCVEReport {
	private final Project project;
	private final BuildStatus status;
	private final List<Alert> alerts;
	
	@JsonCreator(mode = JsonCreator.Mode.PROPERTIES)
	ProjectCVEReport(@NonNull @JsonProperty("project") Project project, @NonNull @JsonProperty("status") BuildStatus status, @JsonProperty("alerts") List<Alert> alerts) {
		this.project = project;
		this.status = status;
		this.alerts = alerts==null ? Collections.emptyList() : alerts.stream().sorted((a1,a2) -> (int)Math.signum(a2.getMaxScore()-a1.getMaxScore())).collect(Collectors.toList());
	}

	public Project getProject() {
		return project;
	}

	public BuildStatus getStatus() {
		return status;
	}

	/** Gets the list of the alerts on this project.
	 * @return A list of alerts, sorted by maximum cause score in descending order.
	 */
	public List<Alert> getAlerts() {
		return alerts;
	}
}
